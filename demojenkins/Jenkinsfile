node {
    try {
        stage ("Begin") {
            //sh "apt install maven"
            echo "Begin ...."
        }

        stage ("Build") {
            //sh 'mvn -f demojenkins/pom.xml clean package'
            echo "Build ...."
        }

        stage ("Test") {
            //step([$class: 'JUnitResultArchiver', testResults: '**/target/surefire-reports/TEST-*.xml'])
            echo "Test ...."
        }

        stage ("Sonarqube") {
            /*sh 'mvn -f demojenkins/pom.xml sonar:sonar \
                    -Dsonar.projectKey=jenkins \
                    -Dsonar.host.url=http://172.17.0.2:9000 \
                    -Dsonar.login=61526cfd42034319c30921a2a3445378684fcfcb' */

            echo "Sonarqube"           
        }

        stage ("Deloy") {
            /*sh "cd /root/.jenkins/workspace/java-full-deloy/demojenkins/target && cp demojenkins-0.0.1-SNAPSHOT.jar /home/namth22/artifact/"
            sh "chmod 777 -R /home/namth22/artifact/."
            
            sh "cd /root/.jenkins/workspace/java-full-deloy/ansible && ansible-playbook java-deloy.yml -i hosts -u namth22 -b"*/
            
            //sh "cd /root/.jenkins/workspace/java-full-deloy/demojenkins/target && java -jar demojenkins-0.0.1-SNAPSHOT.jar"
            //sh "cd /home/namth22/ansible-playbook && ansible-playbook java-deloy.yml -i hosts -u namth22 -b"

            echo "Deloy ...."
        }
    } catch (e) {
        throw e
    } finally {
        def currentResult = currentBuild.result ? 'SUCCESS' : 'FAILURE'

        def DATE = sh(returnStdout: true, script: "date +'%d-%m-%y'")

        def NOTIFICATION_SUCCESS = "'{\"text\":\"NAM == SUCCESS, ${DATE}\"}'"
        def NOTIFICATION_FAILTURE = "'{\"text\":\"NAM == FAILTURE ${DATE}\"}'"
        def API_A = "https://hooks.slack.com/services/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"
        

        if (currentResult == 'SUCCESS') {
            //sh "curl -X POST -H 'Content-type: application/json' --data ${NOTIFICATION_SUCCESS} ${API_A}"
            echo "SUCCESS"
        } else {
            //sh "curl -X POST -H 'Content-type: application/json' --data ${NOTIFICATION_FAILTURE} ${API_A}"
            echo "FAIL"
        }
    }
}